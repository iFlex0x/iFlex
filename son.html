<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iFlex - My AI Assistant</title>
    <link rel="icon" href="images/iflexnew.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Global Styles & Reset */
        html, body {
            margin: 0;
            padding: 0;
            height: 100vh; /* Full viewport height */
            width: 100vw;  /* Full viewport width */
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
            background-color: #0d0d0d; /* Dark base background */
            color: #e0e0e0; /* Light text for contrast */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* Space out chat container and footer */
            align-items: center;
            overflow-x: hidden; /* Prevent horizontal scroll */
            overflow-y: auto; /* Allow vertical scrolling for chat messages */
            scroll-behavior: smooth;
            cursor: url(images/cursor.png), auto; /* Custom cursor */
            position: relative;
        }

        /* Digital Grid Overlay */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(to right, rgba(17, 17, 17, 0.8) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(17, 17, 17, 0.8) 1px, transparent 1px);
            background-size: 40px 40px; /* Adjust grid density */
            animation: grid-pulse 15s ease-in-out infinite alternate;
            pointer-events: none;
            z-index: -1; /* Behind all content */
        }
        
        /* Subtle radial gradient for depth over grid */
        body::after {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at center, rgba(20, 20, 20, 0) 0%, rgba(13, 13, 13, 0.8) 70%, rgba(13, 13, 13, 1) 100%);
            pointer-events: none;
            z-index: 0; /* Above grid, below content */
        }

        /* Particle Canvas: Dynamic background particles */
        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2; /* Furthest back */
            pointer-events: none;
        }

        /* Cursor Trail Canvas */
        #cursorTrailCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1001; /* Above particles, below chat content */
            pointer-events: none;
        }

        /* Main Chat Container - Adjusted for size and responsiveness */
        .chat-container {
            background-color: rgba(25, 25, 25, 0.7); /* More transparent dark background */
            border-radius: 25px; /* More pronounced rounded corners */
            padding: clamp(25px, 5vw, 50px);
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.2), inset 0 0 20px rgba(0, 255, 255, 0.1); /* Cyan glow shadow */
            text-align: center;
            width: 90%; /* Use a percentage for fluid width */
            max-width: 950px; /* Increased max width for a larger feel */
            height: clamp(600px, 80vh, 900px); /* Increased height for larger chat area */
            display: flex;
            flex-direction: column;
            gap: 15px;
            z-index: 2; /* Ensures content is above background elements */
            box-sizing: border-box;
            opacity: 0; /* For entrance animation */
            transform: translateY(20px); /* For entrance animation */
            animation: fadeIn 1s ease-out 0.3s forwards;
            backdrop-filter: blur(10px); /* Frosted glass effect */
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(77, 241, 241, 0.3); /* Subtle cyan border */
            margin-top: clamp(30px, 6vh, 60px); /* Top margin for spacing */
            margin-bottom: 20px; /* Space above footer */
        }

        /* Authentication overlay styles */
        .auth-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1002; /* Above everything but modals */
            opacity: 1;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            flex-direction: column;
            gap: 20px;
        }
        .auth-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .auth-card {
            background-color: rgba(25, 25, 25, 0.8);
            border-radius: 25px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 255, 255, 0.3), inset 0 0 20px rgba(0, 255, 255, 0.15);
            text-align: center;
            max-width: 400px;
            width: 90%;
            border: 1px solid rgba(77, 241, 241, 0.4);
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .auth-card h2 {
            font-size: 2em;
            color: #4df1f1;
            margin-bottom: 15px;
        }
        .auth-card p {
            font-size: 0.9em;
            color: #ccc;
        }
        .auth-card input[type="text"] {
            width: 100%;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(77, 241, 241, 0.3);
            background-color: rgba(0, 0, 0, 0.5);
            color: #e0e0e0;
            font-size: 1em;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .auth-card input[type="text"]:focus {
            border-color: #4df1f1;
            box-shadow: 0 0 10px rgba(77, 241, 241, 0.5);
        }
        .auth-card .button {
            background: linear-gradient(45deg, #4df1f1, #21c2c2);
            color: #0d0d0d;
            padding: 12px 20px;
            border-radius: 15px;
            border: none;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 5px 15px rgba(77, 241, 241, 0.4);
            font-weight: 700;
            width: 100%;
        }
        .auth-card .button:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 8px 20px rgba(77, 241, 241, 0.6);
            filter: brightness(1.1);
        }
        .auth-card .button:disabled {
            background: #333;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
            filter: none;
            color: #999;
        }


        /* Page Title */
        .page-title {
            font-size: clamp(2.5em, 7vw, 4em);
            color: #4df1f1; /* Cyan glow for title */
            margin-bottom: clamp(20px, 4vh, 40px);
            letter-spacing: 2px;
            text-shadow: 0 0 15px rgba(77, 241, 241, 0.8), 0 0 30px rgba(77, 241, 241, 0.5);
            font-weight: 800;
            opacity: 0;
            transform: translateY(-20px);
            animation: slideIn 0.8s ease-out forwards, text-neon-glow 3s infinite alternate ease-in-out;
            text-align: center;
        }

        /* Chat Display Area */
        .chat-display {
            flex-grow: 1;
            background-color: rgba(0, 0, 0, 0.5); /* Very transparent, almost black */
            border-radius: 20px;
            padding: 15px;
            overflow-y: auto;
            text-align: left;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.1); /* Inner cyan glow */
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 1px solid rgba(77, 241, 241, 0.1); /* Lighter border */
        }

        /* Individual Message Styling */
        .message {
            max-width: 80%;
            padding: 12px 18px;
            border-radius: 20px; /* More rounded */
            word-wrap: break-word;
            line-height: 1.5;
            color: #ffffff;
            font-size: clamp(0.9em, 1.8vw, 1em);
            position: relative;
        }

        .user-message {
            background-color: rgba(76, 175, 80, 0.8); /* Slightly transparent green */
            align-self: flex-end;
            border-bottom-right-radius: 8px; /* Softer corner on bottom right */
            box-shadow: 0 4px 10px rgba(76, 175, 80, 0.3);
            border: 1px solid rgba(76, 175, 80, 0.5);
            animation: message-slide-in-right 0.3s ease-out forwards;
        }

        .bot-message {
            background-color: rgba(52, 152, 219, 0.7); /* Slightly transparent blue */
            align-self: flex-start;
            border-bottom-left-radius: 8px; /* Softer corner on bottom left */
            box-shadow: 0 4px 10px rgba(52, 152, 219, 0.3);
            border: 1px solid rgba(52, 152, 219, 0.5);
            animation: message-slide-in-left 0.3s ease-out forwards;
        }

        /* Chat Input Area */
        .chat-input-area {
            display: flex;
            gap: 12px;
            margin-top: 15px;
        }

        .chat-input-area textarea {
            flex-grow: 1;
            padding: 15px 20px;
            border-radius: 20px;
            border: 1px solid rgba(77, 241, 241, 0.3);
            background-color: rgba(25, 25, 25, 0.6);
            color: #e0e0e0;
            font-size: clamp(0.95em, 1.8vw, 1.1em);
            resize: none;
            min-height: 50px;
            max-height: 120px;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.1);
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            box-sizing: border-box;
        }
        .chat-input-area textarea:focus {
            border-color: #4df1f1;
            box-shadow: inset 0 0 10px rgba(0, 255, 255, 0.3), 0 0 20px rgba(77, 241, 241, 0.5);
        }
        .chat-input-area textarea::placeholder {
            color: #aaa;
            opacity: 0.8;
        }

        /* Send Button */
        .chat-button {
            background: linear-gradient(45deg, #4df1f1, #21c2c2); /* Cyan gradient */
            color: #0d0d0d; /* Dark text on bright button */
            padding: 15px 25px;
            border-radius: 20px;
            border: none;
            font-size: clamp(1em, 1.8vw, 1.1em);
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 8px 20px rgba(77, 241, 241, 0.4);
            white-space: nowrap;
            font-weight: 700;
            text-transform: uppercase;
        }
        .chat-button:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 25px rgba(77, 241, 241, 0.6), inset 0 0 15px rgba(255, 255, 255, 0.2);
            filter: brightness(1.2);
        }
        .chat-button:disabled {
            background: #333;
            box-shadow: none;
            cursor: not-allowed;
            transform: none;
            filter: none;
            color: #999;
        }

        /* Loading Dots for Bot Response */
        .loading-dots {
            display: none;
            align-self: flex-start;
            margin-top: 10px;
            color: #4df1f1; /* Cyan dots */
            font-size: clamp(1.5em, 2.8vw, 2em);
            position: relative;
            padding-left: 30px;
            line-height: 1;
        }
        .loading-dots::before {
            content: '...';
            position: absolute;
            left: 0;
            top: 0;
            overflow: hidden;
            width: 0;
            animation: typing-dots-reveal 1s infinite steps(3, end);
        }
        .loading-dots.active {
            display: block;
        }
        .loading-dots.active::before {
             width: auto;
        }

        /* Action Buttons (Reset, Back to Portfolio) */
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: clamp(15px, 2.5vw, 25px);
            margin-top: clamp(20px, 3.5vh, 35px);
            flex-wrap: wrap;
        }
        .action-button {
            background-color: rgba(30, 30, 30, 0.8);
            color: #4df1f1; /* Cyan text */
            padding: clamp(12px, 2vw, 18px) clamp(20px, 3.5vw, 35px);
            border-radius: 15px;
            border: 1px solid rgba(77, 241, 241, 0.2);
            font-size: clamp(0.9em, 1.8vw, 1em);
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-weight: 600;
        }
        .action-button:hover {
            background-color: rgba(40, 40, 40, 0.9);
            border-color: #4df1f1;
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5), 0 0 15px rgba(77, 241, 241, 0.4);
            color: #ffffff;
        }

        /* Global Footer Styles */
        footer {
            width: 100%;
            text-align: center;
            font-size: clamp(0.7em, 1.5vw, 0.9em);
            color: #999;
            padding: clamp(10px, 1.5vh, 20px) 0;
            z-index: 2;
            background-color: #0d0d0d;
            position: relative;
            flex-shrink: 0;
        }
        .footer-buttons {
            display: flex;
            justify-content: center;
            gap: clamp(10px, 2vw, 20px);
            margin-top: clamp(10px, 1.5vw, 15px);
            flex-wrap: wrap;
        }
        .footer-button {
            background-color: #1a1a1a;
            color: #e0e0e0;
            padding: clamp(8px, 1.5vw, 10px) clamp(15px, 3vw, 20px);
            border-radius: 10px;
            text-decoration: none;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: inset 2px 2px 5px rgba(0, 0, 0, 0.3), inset -2px -2px 5px rgba(40, 40, 40, 0.1);
            font-size: 1em;
            white-space: nowrap;
            box-sizing: border-box;
        }
        .footer-button:hover {
            background-color: #2a2a2a;
            transform: translateY(-2px);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.1);
        }

        /* Legal Modal (retained for legal/privacy) */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1005;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }

        .modal-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background-color: #1a1a1a;
            border-radius: 20px;
            padding: clamp(20px, 5vw, 40px);
            box-shadow:
                inset 5px 5px 10px rgba(0, 0, 0, 0.3),
                inset -5px -5px 10px rgba(70, 70, 70, 0.1),
                0 10px 30px rgba(0, 0, 0, 0.7);
            text-align: left;
            max-width: 700px;
            width: 90%;
            position: relative;
            transform: scale(0.8);
            opacity: 0;
            transition: transform 0.3s ease, opacity 0.3s ease;
            box-sizing: border-box;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid rgba(77, 241, 241, 0.2);
        }

        .modal-overlay.show .modal-content {
            transform: scale(1);
            opacity: 1;
        }

        .modal-close-btn {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: clamp(1.5em, 3vw, 2em);
            color: #e0e0e0;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .modal-close-btn:hover {
            color: #4df1f1;
        }

        .modal-content h2 {
            font-size: clamp(1.8em, 4vw, 2.5em);
            color: #4df1f1;
            margin-bottom: 20px;
            text-align: center;
        }
        .modal-content h3 {
            font-size: clamp(1.2em, 2.5vw, 1.6em);
            color: #ffffff;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        .modal-content p {
            font-size: clamp(0.9em, 1.8vw, 1em);
            line-height: 1.6;
            margin-bottom: 15px;
        }
        .modal-content ul {
            list-style-type: disc;
            margin-left: 20px;
            margin-bottom: 15px;
            color: #ccc;
        }
        .modal-content li {
            margin-bottom: 5px;
        }
        .modal-content a {
            color: #4df1f1;
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .modal-content a:hover {
            color: #21c2c2;
            text-decoration: underline;
        }

        /* Keyframe Animations */
        @keyframes grid-pulse {
            0% { background-color: rgba(17, 17, 17, 0.8); }
            50% { background-color: rgba(25, 25, 25, 0.8); }
            100% { background-color: rgba(17, 17, 17, 0.8); }
        }
        @keyframes fadeIn {
            0% { opacity: 0; transform: translateY(20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideIn {
            0% { opacity: 0; transform: translateY(-20px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes text-neon-glow {
            0% { text-shadow: 0 0 15px rgba(77, 241, 241, 0.8), 0 0 30px rgba(77, 241, 241, 0.5); }
            50% { text-shadow: 0 0 25px rgba(77, 241, 241, 1), 0 0 40px rgba(77, 241, 241, 0.7); }
            100% { text-shadow: 0 0 15px rgba(77, 241, 241, 0.8), 0 0 30px rgba(77, 241, 241, 0.5); }
        }
        @keyframes message-slide-in-right {
            0% { opacity: 0; transform: translateX(20px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        @keyframes message-slide-in-left {
            0% { opacity: 0; transform: translateX(-20px); }
            100% { opacity: 1; transform: translateX(0); }
        }
        @keyframes typing-dots-reveal {
            0% { width: 0; }
            33% { width: 0.5em; }
            66% { width: 1em; }
            100% { width: 1.5em; }
        }

        /* Media Queries for Responsiveness */
        @media (max-width: 768px) {
            .chat-container {
                padding: 15px;
                height: 90vh;
                margin-top: 20px;
                margin-bottom: 10px;
                max-width: 95%; /* Make it slightly wider on smaller screens */
            }
            .page-title {
                font-size: 2em;
                margin-bottom: 15px;
            }
            .chat-input-area {
                flex-direction: column;
                gap: 10px;
            }
            .chat-button {
                width: 100%;
                padding: 12px 20px;
                font-size: 1em;
            }
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            .action-button {
                width: 100%;
                padding: 10px 20px;
                font-size: 0.9em;
            }
            .modal-content {
                padding: 20px;
                width: 95%;
                max-height: 85vh;
            }
            .modal-close-btn {
                font-size: 1.8em;
            }
            .auth-card {
                padding: 20px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .chat-container {
                padding: 10px;
                height: 95vh;
                margin-top: 10px;
            }
            .page-title {
                font-size: 1.5em;
                margin-bottom: 10px;
            }
            .message {
                padding: 8px 12px;
                font-size: 0.9em;
            }
            .chat-input-area textarea {
                padding: 10px;
                font-size: 0.9em;
            }
            .chat-button {
                padding: 10px 15px;
                font-size: 0.9em;
            }
            .action-button {
                padding: 8px 15px;
                font-size: 0.8em;
            }
            .modal-content {
                padding: 15px;
                width: 90%;
            }
            .modal-close-btn {
                font-size: 1.5em;
            }
        }
    </style>
</head>
<body>
    <canvas id="particleCanvas"></canvas>
    <canvas id="cursorTrailCanvas"></canvas>

    <!-- Authentication Overlay -->
    <div id="authOverlay" class="auth-overlay">
        <div class="auth-card">
            <h2>Welcome to My AI Assistant!</h2>
            <p>To ensure personalized conversations, please authorize with Shapes.inc. This connects your chat history to your Shapes.inc account.</p>
            <button id="loginBtn" class="button"><i class="fas fa-sign-in-alt"></i> Login with Shapes.inc</button>
            <div id="codeEntry" style="display:none;">
                <p>After logging in/authorizing, copy the one-time code and paste it below:</p>
                <input type="text" id="oneTimeCodeInput" placeholder="Paste one-time code here">
                <button id="submitCodeBtn" class="button" disabled><i class="fas fa-check"></i> Submit Code</button>
            </div>
            <p id="authStatus" style="color:#4df1f1; font-size:0.9em;"></p>
        </div>
    </div>

    <div class="chat-container">
        <h1 class="page-title">My AI Assistant</h1>
        <div id="chatDisplay" class="chat-display">
            <!-- Initial greeting will be added after successful authentication -->
        </div>
        <div id="loadingDots" class="loading-dots"></div>
        <div class="chat-input-area">
            <textarea id="chatInput" placeholder="Type your message..." disabled></textarea>
            <button id="sendMessageBtn" class="chat-button" disabled>Send</button>
        </div>
        <div class="action-buttons">
            <button id="resetChatBtn" class="action-button" disabled>Reset Chat</button>
            <button id="backToPortfolioBtn" class="action-button">Back to Portfolio</button>
        </div>
    </div>

    <!-- Legal Modal (hidden by default) -->
    <div id="legalModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn">×</button>
            <h2>Legal Information & Privacy Policy</h2>

            <h3>1. General Disclaimer</h3>
            <p>This website is a personal portfolio created and maintained by iFlex. Its purpose is to showcase my projects, skills, and interests in web development and AI. All content is provided for informational and demonstration purposes only.</p>

            <p>All original content on this site, including text, design, and custom code (excluding third-party libraries and services), is my intellectual property. Please do not reproduce or distribute without my explicit permission.</p>

            <p>This site may contain links to third-party websites. I am not responsible for the content or privacy practices of these external sites.</p>
            <p>By using this website, you agree to these terms and conditions.</p>

            <h3>2. AI Bot Disclaimer ("My AI Assistant")</h3>
            <p>The "My AI Assistant" bot featured on this site is an AI chatbot developed for demonstration and entertainment purposes only. It is powered by a third-party AI service, <a href="https://shapes.inc/" target="_blank" rel="noopener noreferrer">Shapes.inc</a>.</p>
            <ul>
                <li>The bot's responses are generated by artificial intelligence and may be inaccurate, incomplete, or offensive.</li>
                <li>Do not share any sensitive personal, financial, or confidential information with the bot.</li>
                <li>The bot is not intended to provide professional advice (e.g., legal, medical, financial).</li>
                <li>I am not responsible for any outcomes or consequences resulting from the use of the bot's responses.</li>
            </ul>

            <h3>3. Privacy Policy</h3>
            <p>Your privacy is important to me. This section outlines how data is handled on this personal portfolio site.</p>

            <h4>Information Collection & Use:</h4>
            <ul>
                <li>
                    <strong>No Direct Personal Data Collection:</strong> This website does not directly collect any personally identifiable information (e.g., your name, email address, IP address) from visitors, other than what you voluntarily provide through interactions with the AI bot.
                </li>
                <li>
                    <strong>AI Bot Interaction Data:</strong> When you interact with the "My AI Assistant" bot:
                    <ul>
                        <li>Your messages are sent to a third-party AI service, <strong>Shapes.inc</strong>. Shapes.inc processes these messages to generate responses and maintain conversation context. Please refer to <strong>Shapes.inc's own privacy policy</strong> for detailed information on their data collection, storage, and usage practices.</li>
                        <li>To maintain your individual conversation context, a unique User ID and Channel ID are generated and stored locally in your browser's `localStorage`. This information is used solely to differentiate your chat sessions and is not linked to any personal data collected by me. These IDs can be reset by clearing your browser's data or by using the "Reset Chat" button on the bot page.</li>
                    </ul>
                </li>
                <li>
                    <strong>Analytics (Optional - if you add any):</strong> If this site were to use web analytics services (like Google Analytics in the future), only anonymized usage data would be collected to understand site performance and visitor behavior. No personally identifiable information would be shared.
                 </li>
                </ul>

             <h4>Data Storage & Security:</h4>
                <p>No user data is stored on my personal servers. Information processed by the AI bot is handled by Shapes.inc. Local browser storage (`localStorage`) is used for user/channel IDs as described above.</p>

                <h4>Your Choices:</h4>
                <p>You can clear your browser's `localStorage` at any time to remove the locally stored User ID and Channel ID, which will start a new chat session with the bot.</p>

             <h3>4. Contact Information</h3>
             <p>If you have any questions or concerns regarding this website or its privacy practices, please feel free to contact me at:</p>
             <p>Email: <a href="mailto:ad.iflex@hotmail.com">ad.iflex@hotmail.com</a></p>
                <p>Last Updated: June 2, 2025</p>
            </div>
        </div>

    <!-- Footer -->
    <footer>
        <p>© 2025 iFlex. All rights reserved.</p>
        <div class="footer-buttons">
            <a href="#" id="legalBtn" class="footer-button">Legal</a>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const chatDisplay = document.getElementById('chatDisplay');
            const chatInput = document.getElementById('chatInput');
            const sendMessageBtn = document.getElementById('sendMessageBtn');
            const loadingDots = document.getElementById('loadingDots');
            const resetChatBtn = document.getElementById('resetChatBtn');
            const backToPortfolioBtn = document.getElementById('backToPortfolioBtn');
            const legalBtn = document.getElementById('legalBtn');
            const legalModal = document.getElementById('legalModal');
            const modalCloseBtns = document.querySelectorAll('.modal-close-btn');

            // Auth specific elements
            const authOverlay = document.getElementById('authOverlay');
            const loginBtn = document.getElementById('loginBtn');
            const codeEntry = document.getElementById('codeEntry');
            const oneTimeCodeInput = document.getElementById('oneTimeCodeInput');
            const submitCodeBtn = document.getElementById('submitCodeBtn');
            const authStatus = document.getElementById('authStatus');

            // Configuration values (these will be set via Netlify environment variables in production)
            // For local development, you might hardcode them or use a build step to inject.
            const SHAPESINC_APP_ID = 'ae8658cf-5f6b-4ca8-b234-16c23e85a49f'; // Updated to your provided App ID
            const SHAPESINC_SITE_URL = 'https://shapes.inc';

            let userAuthToken = null;
            let currentChannelId; // Unique for each session/page load

            // Helper for displaying messages to user
            function showStatus(message, isError = false) {
                authStatus.textContent = message;
                authStatus.style.color = isError ? '#ff6b6b' : '#4df1f1';
            }

            /**
             * Initializes a new conversation channel for the current authenticated user.
             * This should be called on page load and when the "Reset Chat" button is clicked.
             */
            function initializeNewChannel() {
                // Generate a new channel ID for each new chat session/page load
                currentChannelId = crypto.randomUUID();
                sessionStorage.setItem('aiSonChannelId', currentChannelId); // Store in sessionStorage for current tab

                console.log('Frontend (son.html) - New Channel Initialized. Channel ID:', currentChannelId);

                chatDisplay.innerHTML = '<div class="bot-message message">hello there! i\'m an ai designed to assist and chat. how can i help you today?</div>';
                chatInput.value = '';
                chatInput.style.height = 'auto';

                // Send a silent '!wack' to the bot immediately to clear its short-term context
                // for this specific new channel.
                if (userAuthToken) {
                    console.log('Sending silent !wack to Shapes.inc for new channel...');
                    sendToBot('!wack', true).then(() => {
                        console.log('Silent !wack sent successfully for new channel.');
                    }).catch(error => {
                        console.error('Failed to send silent !wack for new channel:', error);
                    });
                }
            }

            /**
             * Handles the initial login/authorization flow.
             */
            async function handleUserAuth() {
                // Try to load an existing token from sessionStorage
                const storedToken = sessionStorage.getItem('shapesUserAuthToken');
                if (storedToken) {
                    userAuthToken = storedToken;
                    console.log('User auth token loaded from sessionStorage.');
                    proceedToChat();
                    return;
                }

                // If no token, show the authentication overlay
                authOverlay.classList.remove('hidden');

                // Listener for login button click
                loginBtn.addEventListener('click', () => {
                    const authorizeUrl = `${SHAPESINC_SITE_URL}/authorize?app_id=${SHAPESINC_APP_ID}`;
                    window.open(authorizeUrl, '_blank', 'noopener,noreferrer');
                    loginBtn.style.display = 'none'; // Hide login button
                    codeEntry.style.display = 'block'; // Show code input
                    showStatus('Please login/authorize in the new window. Then, copy the one-time code and paste it below.');
                });

                // Listener for one-time code input
                oneTimeCodeInput.addEventListener('input', () => {
                    submitCodeBtn.disabled = oneTimeCodeInput.value.trim() === '';
                });

                // Listener for submit code button
                submitCodeBtn.addEventListener('click', async () => {
                    const oneTimeCode = oneTimeCodeInput.value.trim();
                    if (!oneTimeCode) {
                        showStatus('Please enter the one-time code.', true);
                        return;
                    }

                    submitCodeBtn.disabled = true;
                    showStatus('Exchanging code for token...');

                    try {
                        // Call your Netlify function to exchange the one-time code
                        const response = await fetch('/.netlify/functions/exchange-token', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ oneTimeCode: oneTimeCode, appId: SHAPESINC_APP_ID }),
                        });

                        const data = await response.json();

                        if (response.ok && data.auth_token) {
                            userAuthToken = data.auth_token;
                            sessionStorage.setItem('shapesUserAuthToken', userAuthToken); // Store token
                            showStatus('Authentication successful!');
                            console.log('User auth token received and stored.');
                            proceedToChat();
                        } else {
                            const errorMsg = data.message || 'Failed to exchange code for token. Ensure it is correct and not expired.';
                            showStatus(errorMsg, true);
                            console.error('Token exchange failed:', errorMsg);
                        }
                    } catch (error) {
                        showStatus(`Network error during token exchange: ${error.message}`, true);
                        console.error('Network error:', error);
                    } finally {
                        submitCodeBtn.disabled = false;
                    }
                });
            }

            /**
             * Proceeds to display the chat interface and enables controls.
             */
            function proceedToChat() {
                authOverlay.classList.add('hidden'); // Hide authentication overlay
                chatInput.disabled = false;
                sendMessageBtn.disabled = false;
                resetChatBtn.disabled = false;
                initializeNewChannel(); // Start a new channel for this authenticated user
            }

            /**
             * Sends a message to the Shapes.inc bot via the Netlify function.
             * @param {string} messageToSend - The message content.
             * @param {boolean} isSilent - If true, the message and bot response are not added to the chat display.
             */
            async function sendToBot(messageToSend, isSilent = false) {
                if (!userAuthToken) {
                    console.error("No user authentication token available.");
                    if (!isSilent) addMessage("Authentication required to chat.", 'bot');
                    return;
                }

                if (!isSilent) {
                    sendMessageBtn.disabled = true;
                    loadingDots.classList.add('active');
                }

                try {
                    const response = await fetch('/.netlify/functions/shapes-chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-App-ID': SHAPESINC_APP_ID,     // Application ID
                            'X-User-Auth': userAuthToken,    // User-specific auth token
                            'X-Channel-Id': currentChannelId // Unique channel for this session
                        },
                        body: JSON.stringify({ message: messageToSend })
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(`API Error: ${response.status} - ${errorData.error || 'Unknown error'}`);
                    }

                    const data = await response.json();
                    if (!isSilent) {
                        addMessage(data.response, 'bot');
                    }
                    return data.response; // Return bot's response if needed
                } catch (error) {
                    console.error('Error sending message:', error);
                    if (!isSilent) {
                        addMessage(`Error: ${error.message}. Please try again.`, 'bot');
                    }
                    return null;
                } finally {
                    if (!isSilent) {
                        sendMessageBtn.disabled = false;
                        loadingDots.classList.remove('active');
                    }
                }
            }

            function addMessage(text, sender) {
                const messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.classList.add(sender === 'user' ? 'user-message' : 'bot-message');
                messageDiv.textContent = text;
                chatDisplay.appendChild(messageDiv);
                chatDisplay.scrollTop = chatDisplay.scrollHeight;
            }

            async function handleSendMessage() {
                const message = chatInput.value.trim();
                if (!message) return;

                addMessage(message, 'user');
                chatInput.value = '';
                chatInput.style.height = 'auto'; // Reset textarea height

                // Send the actual user message
                await sendToBot(message, false);
            }

            sendMessageBtn.addEventListener('click', handleSendMessage);
            chatInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            });

            chatInput.addEventListener('input', () => {
                chatInput.style.height = 'auto';
                chatInput.style.height = (chatInput.scrollHeight) + 'px';
            });

            resetChatBtn.addEventListener('click', () => {
                // Manually trigger a new channel initialization
                initializeNewChannel();
                console.log('Manual chat reset initiated (new channel).');
            });

            backToPortfolioBtn.addEventListener('click', () => {
                window.location.href = 'index.html';
            });

            // Legal Modal Functionality (retained)
            function openModal(modalElement) {
                modalElement.classList.add('show');
                document.body.classList.add('modal-open');
            }

            function closeModal(modalElement) {
                modalElement.classList.remove('show');
                document.body.classList.remove('modal-open');
            }

            legalBtn.addEventListener('click', (e) => {
                e.preventDefault();
                openModal(legalModal);
            });

            modalCloseBtns.forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const modalOverlay = e.target.closest('.modal-overlay');
                    if (modalOverlay) {
                        closeModal(modalOverlay);
                    }
                });
            });

            legalModal.addEventListener('click', (e) => {
                if (e.target === legalModal) {
                    closeModal(legalModal);
                }
            });

            // Particle Background Setup (retained)
            const particleCanvas = document.getElementById('particleCanvas');
            const particleCtx = particleCanvas.getContext('2d');
            let particles = [];
            const particleCount = 50;
            const maxRadius = 1.5;
            const minRadius = 0.5;
            const maxSpeed = 0.3;

            function resizeCanvas(canvas) {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            }

            class Particle {
                constructor() {
                    this.x = Math.random() * particleCanvas.width;
                    this.y = Math.random() * particleCanvas.height;
                    this.radius = Math.random() * (maxRadius - minRadius) + minRadius;
                    this.color = `rgba(255, 255, 255, ${Math.random() * 0.2 + 0.05})`;
                    this.speedX = (Math.random() - 0.5) * maxSpeed;
                    this.speedY = (Math.random() - 0.5) * maxSpeed;
                }

                draw() {
                    particleCtx.beginPath();
                    particleCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    particleCtx.fillStyle = this.color;
                    particleCtx.fill();
                }

                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;

                    if (this.x < 0 - this.radius) this.x = particleCanvas.width + this.radius;
                    if (this.x > particleCanvas.width + this.radius) this.x = 0 - this.radius;
                    if (this.y < 0 - this.radius) this.y = particleCanvas.height + this.radius;
                    if (this.y > particleCanvas.height + this.radius) this.y = 0 - this.radius;
                }
            }

            function initParticles() {
                particles = [];
                for (let i = 0; i < particleCount; i++) {
                    particles.push(new Particle());
                }
            }

            function animateParticles() {
                requestAnimationFrame(animateParticles);
                particleCtx.clearRect(0, 0, particleCanvas.width, particleCanvas.height);

                particles.forEach(particle => {
                    particle.update();
                    particle.draw();
                });
            }

            resizeCanvas(particleCanvas);
            initParticles();
            animateParticles();
            window.addEventListener('resize', () => {
                resizeCanvas(particleCanvas);
                initParticles();
            });

            // Cursor Trail Particles (retained)
            const cursorTrailCanvas = document.getElementById('cursorTrailCanvas');
            const cursorTrailCtx = cursorTrailCanvas.getContext('2d');
            let cursorParticles = [];
            const cursorParticleMaxAge = 60;
            const cursorParticleSize = 1;
            const cursorParticleDensity = 2;

            class CursorParticle {
                constructor(x, y) {
                    this.x = x;
                    this.y = y;
                    this.radius = cursorParticleSize;
                    this.alpha = 0.5;
                    this.life = 0;
                    this.speedX = (Math.random() - 0.5) * 0.5;
                    this.speedY = (Math.random() - 0.5) * 0.5;
                }

                draw() {
                    cursorTrailCtx.beginPath();
                    cursorTrailCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                    cursorTrailCtx.fillStyle = `rgba(255, 255, 255, ${this.alpha})`;
                    cursorTrailCtx.fill();
                }

                update() {
                    this.x += this.speedX;
                    this.y += this.speedY;
                    this.life++;
                    this.alpha = 0.5 - (this.life / cursorParticleMaxAge) * 0.5;
                    if (this.alpha < 0) this.alpha = 0;
                }
            }

            function animateCursorTrail() {
                requestAnimationFrame(animateCursorTrail);
                cursorTrailCtx.clearRect(0, 0, cursorTrailCanvas.width, cursorTrailCanvas.height);

                for (let i = cursorParticles.length - 1; i >= 0; i--) {
                    cursorParticles[i].update();
                    if (cursorParticles[i].life >= cursorParticleMaxAge || cursorParticles[i].alpha <= 0) {
                        cursorParticles.splice(i, 1);
                    } else {
                        cursorParticles[i].draw();
                    }
                }
            }

            document.addEventListener('mousemove', (e) => {
                for (let i = 0; i < cursorParticleDensity; i++) {
                    cursorParticles.push(new CursorParticle(e.clientX, e.clientY));
                }
            });

            resizeCanvas(cursorTrailCanvas);
            animateCursorTrail();
            window.addEventListener('resize', () => resizeCanvas(cursorTrailCanvas));

            // Start the user authentication flow on DOMContentLoaded
            handleUserAuth();
        });
    </script>
</body>
</html>
